@{
    ViewData["Title"] = "Open Redirect";
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>@ViewData["Title"]</title>
    <link rel="stylesheet" href="~/css/app.css" />
</head>
<body>

    <h1 style="text-align: center; margin-bottom: 40px;">üß™ Open Redirect Demo</h1>

    <div class="container">
        <!-- Vulnerable Functionality -->
        <div class="box">
            <h2>
                Follow me on LinkedIn :)
                <a
                href="/Home/OpenRedirect?returnUrl=https://www.linkedin.com/in/soham-das-/"
                class="li-btn"
                target="_blank"
                rel="noopener noreferrer"
                aria-label="Follow me on LinkedIn"
                >
                <svg class="li-icon" viewBox="0 0 24 24" aria-hidden="true">
                    <path d="M20.447 20.452h-3.554v-5.57c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.447-2.136 2.942v5.665H9.351V9h3.413v1.561h.048c.476-.9 1.637-1.852 3.367-1.852 3.601 0 4.266 2.371 4.266 5.454v6.289zM5.337 7.433a2.063 2.063 0 1 1 0-4.126 2.063 2.063 0 0 1 0 4.126zM7.114 20.452H3.556V9h3.558v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.226.792 24 1.771 24h20.451C23.2 24 24 23.226 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                </svg>
                <span>LinkedIn</span>
                </a>
                ...
            </h2>

            <h2>
                Follow me on GitHub :)
                <a
                href="/Home/OpenRedirect?returnUrl=https://github.com/Soham7-dev"
                class="gh-btn"
                target="_blank"
                rel="noopener noreferrer"
                aria-label="Follow me on GitHub"
                >
                <svg class="gh-icon" viewBox="0 0 24 24" aria-hidden="true">
                    <path d="M12 .5C5.65.5.5 5.65.5 12c0 5.09 3.29 9.4 7.86 10.93.58.1.79-.25.79-.55v-2.17c-3.2.7-3.88-1.54-3.88-1.54-.53-1.34-1.3-1.7-1.3-1.7-1.06-.73.08-.72.08-.72 1.18.08 1.8 1.22 1.8 1.22 1.04 1.79 2.73 1.27 3.4.97.1-.75.41-1.27.74-1.56-2.55-.29-5.23-1.28-5.23-5.7 0-1.26.45-2.28 1.19-3.08-.12-.3-.52-1.51.11-3.15 0 0 .97-.31 3.18 1.18a11.09 11.09 0 0 1 5.79 0c2.21-1.49 3.18-1.18 3.18-1.18.63 1.64.23 2.85.11 3.15.74.8 1.19 1.82 1.19 3.08 0 4.43-2.68 5.4-5.24 5.69.42.36.8 1.08.8 2.18v3.24c0 .31.21.66.8.55A10.999 10.999 0 0 0 23.5 12C23.5 5.65 18.35.5 12 .5z"/>
                </svg>
                <span>GitHub</span>
                </a>
                ...
            </h2>
        </div>

        <!-- Secure Coding Challenge -->
        <div class="box">
            <h2>üîê Secure the Code</h2>
            <p>This page is vulnerable to <strong>Open Redirect.</strong></p>
            <p>Your task is to identify the line that causes this vulnerability and fix it.</p>
            <button class="btn btn-outline-dark mt-2" onclick="openCodePopup()">üïµÔ∏è Identify the Vulnerability</button>
        </div>
    </div>

    <h6 style="margin: 25px;">More Information:</h6>
    <ul>
        <li><a href="https://learn.snyk.io/lesson/open-redirect/?ecosystem=csharp">SNYK - Open Redirect</a></li>
        <li><a href="https://portswigger.net/kb/issues/00500100_open-redirection-reflected">PortSwigger - Open Redirection</a></li>
        <li><a href="https://www.invicti.com/learn/open-redirect-open-redirection/">Invicti - Open Redirect</a></li>
    </ul>

    <!-- Diff Modal (Secure Version) -->
    <div id="diffModal" class="diff-modal">
        <div class="diff-content">
            <h3>‚úÖ Secure Version</h3>

            <div class="diff-line removed">- if (returnUrl != null)</div>
            <div class="diff-line removed">- {</div>
            <div class="diff-line removed">-     return Redirect(returnUrl);</div>
            <div class="diff-line removed">- }</div>

            <div class="diff-line added">+ // Create a whitelist of URLs</div>
            <div class="diff-line added">+ var allowedUrls = new List&lt;string&gt;</div>
            <div class="diff-line added">+ {</div>
            <div class="diff-line added">+     "https://www.linkedin.com/in/soham-das-/",</div>
            <div class="diff-line added">+     "https://github.com/Soham7-dev"</div>
            <div class="diff-line added">+ };</div>
            <div class="diff-line added">+ // Fallback to the Home page if the returnUrl parameter doesn't match</div>
            <div class="diff-line added">+ if (allowedUrls.Contains(returnUrl, StringComparer.OrdinalIgnoreCase))</div>
            <div class="diff-line added">+     return Redirect(returnUrl);</div>
            <div class="diff-line added">+ else</div>
            <div class="diff-line added">+     return RedirectToAction("Dashboard", "Home");</div>

            <br />
            <button onclick="closeDiffPopup()">Close</button>
        </div>
    </div>

    <script src="~/js/openre.js"></script>

</body>
